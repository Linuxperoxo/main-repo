# AUTHOR: Linuxperoxo
# MAINTAINER: Linuxperoxo
# Depends on: gcc make binutils perl bc dracut 
# Optional: grub

name="kernel"
version="6.9.2"
extension="tar.xz"
use_tools="N"
source_url="https://cdn.${name}.org/pub/linux/${name}/v6.x/linux-${version}.${extension}"

pre_build()
{
	cd linux-$version
	make mrproper
	make clean
}

build()
{
	zcat /proc/config.gz > $PWD/.config
	make localmodconfig
	make menuconfig
	make
}

install()
{
	make modules_install
	
	cp arch/x86/boot/bzImage /boot/vmlinux-$version-$name
	cp System.map /boot/System.map-$version-$name
	cp .config /boot/config-$version-$name

	dracut --force /boot/initramfs-$version-$name.img $version-$name
}

pos_install()
{
	cd ..
	
	mv linux-$version /usr/src/

	cd /usr/src/

	ln -s linux-$version linux

	if [ "$(command	-v grub-mkconfig)" != '' ]; then
		grub-mkconfig -o /boot/grub/grub.cfg
		echo -e ">>> ${GREEN}SUCCESS${NC} All done! >:)"
		sleep 2
	else
		echo ">>> [${YELLOW}***${NC}] ${YELLOW}WARNING${NC}: grub not installed"
	fi
}
